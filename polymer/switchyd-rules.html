<link rel='import' href='../bower_components/polymer/polymer.html'>

<link rel='import' href='switchyd-list.html'>

<polymer-element name='switchyd-rules' extends='switchyd-list'>
    <template>
        <shadow></shadow>
    </template>
    
    <script>
        Polymer('switchyd-rules',{
            error : 'shoule start with net::',

            ready : function(){
                var self = this;

                chrome.runtime.getBackgroundPage(function(app){
                    var switchyd = app.switchyd;
                    
                    var rules = [];
                    for(var rule in switchyd.config.rules){
                        rules.push({value:rule});
                    }
                    
                    self.datas = rules;
                    if(self.datas.length <= 0){
                        self.datas.push({value:'net::ERR_EXAMPLE'});
                    }
                });
            },

            parse : function(input){
                if(input.startsWith('net::')){
                    return input;
                }

                return null;
            },

            sync : function(datas){
                var self = this;
                chrome.runtime.getBackgroundPage(function(app){
                    var switchyd = app.switchyd;

                    // build new rules
                    var new_rules = {};
                    datas.forEach(function(rule){
                        rule = rule.value;
                        if(rule in switchyd.config.rules){
                            new_rules[rule] = switchyd.config.rules[rule];
                            delete switchyd.config.rules[rule];
                            return;
                        }

                        new_rules[rule] = 0;
                    });

                    // replace
                    switchyd.config.rules = new_rules;
                });
            }
        });
    </script>
</polymer-element>

