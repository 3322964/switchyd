<link rel='import' href='../bower_components/polymer/polymer.html'>

<link rel='import' href='switchyd-list.html'>

<polymer-element name='switchyd-urls' extends='switchyd-list'>
    <template>
        <shadow></shadow>
    </template>

    <script>
        Polymer('switchyd-urls',{
            publish : {
                tracer:null,
            },
            
            error: 'at least 3 level of domain names, like www.google.com , google.com is not accatable',

            ready : function(){
                var self = this;
                chrome.runtime.getBackgroundPage(function(app){
                    var switchyd = app.switchyd;
                    self.datas = switchyd.expand(switchyd.config.tracers[self.tracer]).map(
                        function(unit){
                            return {
                                value:unit
                            };
                        }    
                    );
                    if(self.datas.length <= 0){
                        self.datas.push({value:self.tracer+'.example.com'});
                    }
                });
            },

            parse : function(input){
                if(input.split('.').length < 2 ){
                    return null;
                }

                return input;
            },
            
            sync : function(datas){
                var self = this;
                chrome.runtime.getBackgroundPage(function(app){
                    var switchyd = app.switchyd;
                    
                    var workspace = switchyd.tracer(self.tracer+'-workspace');
                    // reset 
                    workspace.urls = {};
                    datas.forEach(function(url){
                        workspace.track(url.value);    
                    });
                    
                    // compile and optimize
                    switchyd.config.tracers[self.tracer] = switchyd.optimize(switchyd.compile(workspace));
                    // activate
                    switchyd.sync.save();
                    switchyd.async.enqueue();
                    
                    return;
                    // refresh
                    self.datas = switchyd.expand(switchyd.config.tracers[self.tracer]).map(
                        function(unit){
                            return {
                                value:unit
                            };
                        }    
                    );
                    console.log(self.datas);
                });
            }
        });
    </script>
</polymer-element>
