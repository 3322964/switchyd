<script>
    SwitchydActivePageAnimationBehavior = {
        playActiveAnimation : function(){
            this.$.page.playActiveAnimation(); 
        },
    };

    SwitchydCommunicateBehavior = {
        talk : function(){
            var pendings = [];
            return function(callback){
                pendings.push(callback);
                
                var self = this;
                this.debounce('switchyd-batch',function(){
                    chrome.runtime.getBackgroundPage(function(page){
                        var switchyd = page.switchyd;
                        var delay = 100;
                        var interval = 500;
                        for(var pending = pendings.pop(); pending != undefined; pending = pending.pop()){
                            var wrap = pending;
                            self.async(function(){
                                wrap(switchyd);
                            },delay);
                            delay += interval;
                        }
                    });
                });
            };
        }(),
    };
</script>
